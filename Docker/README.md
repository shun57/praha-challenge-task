# Dockerで環境差分を吸収する

## 課題1（質問）

* Dockerとは?

Webアプリケーションを開発・実行できる仮想環境をつくれるツールのこと。
1つの仮想環境をコンテナという箱に作って、自分のPC上に複数のコンテナを用意できる。
コンテナの中にミドルェアなどを入れることができて、WebサーバやDBサーバを作ることができる。
コンテナの定義はコードベースで管理できるので、他の開発者と簡単に共有できて、開発環境に差分が出づらい。


### 用語

* イメージ

コンテナをつくるための手順を含んだ読み取り専用の雛形。独自に作成するか、レジストリで公開されたイメージを使うことができる。

* コンテナ

イメージを実行可能なインスタンス。ネットワークに接続したり、ストレージを接続したり、コンテナをもとに新しいイメージをつくることもできる。

* ベースイメージ

ほとんどのイメージは親イメージがあるが、親がないコンテナのベースとなるイメージがある。それがベースイメージ。Dockerfile の中で FROM scratch の指定がある。

* Dockerレジストリ

dockerイメージの保管庫。dockerhubという公開レジストリもあり、誰でも利用できる。デフォルトではdockerhubイメージを探す様になっている。独自のプライベートレジストリを運用することもできる。

* ビルドコンテキスト

dockerfileをbuildするしてイメージを作る際に指定するディレクトリ。docker demonに送信される。イメージに必要なアプリケーションや依存ファイルを指定する。

* マルチステージビルド

段階を分けてイメージをビルドできる機能。各段階の成果物を以降のビルド段階にコピーできる。それによって最終的なイメージを軽量化できる。

* Dockerfileを作成して環境構築をコード化する事にはどのようなメリットがあるのでしょうか？

1. 環境構築の手順がシンプルになる
1. 他の開発者との差分が出ない
1. コードを見れば設定がわかる
1. 管理しやすい
1. 環境構築を高速化できる

* docker-composeはどのような場面で役立ちそうでしょうか？

1. アプリの立ち上げに必要な複数のコンテナを一斉に立ち上げたい時

* .dockerignoreにはどのようなファイルやディレクトリを含めると良いでしょうか？

1. ビルド時に追加されるnode_modulesなど
1. 一時ファイルやログファイルなど
1. 秘匿情報のあるenvなど

* パッケージについて

キャッシュによる問題が発生するため。
例えばinstallに新しいパッケージを加えた場合でも、同じコマンドとしてキャッチを再利用する。
そのため、updateが実行されず、古いバージョンのまま利用されてしまう。

* ENVについて

ENVはビルド時の環境変数を定義できるため、その行以降のコマンドでアクセスできたり、コンテナ環境でも持続する
RUNは一時的な環境変数であり、同一のRUN内でしか使えず、コンテナ環境では持続しない

https://www.ted027.com/post/dockerfile/#envとarg-とrun

## 課題2

* Dockerfile
https://github.com/shun57/praha-challenge-ddd/pull/21

* DockerCompose
https://github.com/shun57/praha-challenge-ddd/pull/22