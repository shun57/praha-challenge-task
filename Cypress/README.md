# 課題 : E2Eテストを書こう

[課題内容](https://airtable.com/appPxhCPFYGqqN9YU/tblVlFr2q4lIqDKYc/viwX8r6DpCRp80swL/recMbjkUv2nb6eauN?blocks=hide)

## 課題1

[ReactチュートリアルにCypressを導入](https://github.com/shun57/react-tutorial/pull/3)

## 課題2

### E2Eテスト

本番環境に近い状況で、ユーザによる画面操作と同様に画面を操作し、挙動が期待通りになっているかシステム全体を通して確認をするテスト手法のこと。

#### メリット

- 本番環境に近い状況でテストできるため、開発環境のテストで見つからなかったバグを検出することができる
- 異なるブラウザでの動作をテストできる
- 今後大きな改修が見込まれたり、ユニットテストがなかったり、仕様が複雑な場合、安全に安全に改修できる確率が高まる
- PJが大きくなったときに、手動でまかなえないテストを自動化できる

#### デメリット

- 実行が不安定（ネットワークの状況などの環境要因で失敗するなど)
- 導入・運用コストが高い（文言変更だけでもテスト修正が必要）
- 実行速度が遅い（テストに時間がかかる）

### テスト手法の選択基準

手法例：単体、機能、結合、E2E

- 新規開発で画面(UI)側の仕様が変わっていく可能性が高い場合、「単体>機能>結合>E2E」の順
- 既存改修が見込め、画面(UI)がほぼ確定していて、単体テストしかない場合かつ画面仕様が複雑で手動テストするのが大変な場合、E2E>単体
- 既存改修が見込め、テストがいっさい書かれていない場合、E2Eで最低限の動作を保証し、単体テストを追加できるリファクタリングを進める
- 改修予定がほぼない場合、「単体>機能>結合>E2E」

※TODO:余裕あればもっと言語化

### E2E要素選択の注意

#### 要素のcssのclassを識別子に使うと？

- classが複数の要素に設定された場合に、どの要素か特定できずにエラーになってしまう
- CSSの修正などでclass名を変えたり削除された場合にテストにも影響してしまう

#### 要素のcssのidを識別子に使うと？

- idを変える変更があった場合にテストに影響を与えてしまう
- フレームワークでidが管理される状況になるためアップデートなどの要因で変わってしまう可能性がある

#### 要素の文言を識別子に使うと？

- 文言修正の際に、一意性が担保できなくなってしまう可能性がある

#### どのような要素を指定すればテストは壊れにくいか？

- data-*属性を使うと、CSSやJSに依存せずにテストできる
- ただし管理コストは増大する

#### 参考

https://blog.autify.com/ja/why-id-should-not-be-used

## 課題3

### Cypress Studio

https://github.com/shun57/react-tutorial/pull/3/commits/3899b81afd2b9793080989492f2445f29cbd30a5

#### 参考

https://docs.cypress.io/guides/references/cypress-studio

## 課題4

1. Cypressにおいて、外部サイトへのアクセスのテストはアンチパターンでしょうか？その場合、推奨されない理由も教えてください。
2. Cypressで選べるテストタイプのコンポーネントテストとはなんでしょうか？
3. CypressとSeleniumの違いを教えてください。



#### 参考

https://docs.cypress.io/guides/references/best-practices

https://github.com/cypress-io/cypress-realworld-app