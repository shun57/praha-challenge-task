# 課題

[課題内容](https://airtable.com/appPxhCPFYGqqN9YU/tblVlFr2q4lIqDKYc/viwX8r6DpCRp80swL/recVifKiAB3LcV6MR?blocks=hide)

## 課題1

1. メッセージの階層が深くなった時に、メッセージ全体を取得するのが不便（再帰的に取得することができず、SQL文がどんどん増えていく）。
2. 階層が不特定多数の場合は取得できなくなる。
3. 子を持つ親メッセージを削除した場合、子は参照する親メッセージが消えてしまい、データの整合性が取れなくなってしまう。回避するには、さらに親のメッセージに紐付けするか、紐づく子を全て削除する必要が出てくる。

### アンチパターンを使用してもいい場合

- 階層の深さが固定
- 再帰クエリを使用できる場合
- 親子関係だけわかればいいだけの場合

## 課題2

※DBモデリング3と同じ、閉包テーブルとする
[ダイアグラム](https://dbdiagram.io/d/61ab38218c901501c0e04afc)

## 課題3

- 本のECサイトでカテゴリーをツリー構造で持ちたい場合。ex. 国内-小説-ミステリー、海外-雑誌-科学


## 参照情報

[Railsでツリー構造（階層構造）をもったカテゴリを隣接リストモデルで実装する](https://qiita.com/yuyasat/items/1200d7a6b56bae0c6f57)  

[SQLアンチパターン　ナイーブツリー](https://qiita.com/fktnkit/items/57033c10b41b5747dbea)
