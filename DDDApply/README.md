# DDDを学ぶ（応用）

[課題内容](https://airtable.com/appPxhCPFYGqqN9YU/tblVlFr2q4lIqDKYc/viwX8r6DpCRp80swL/recdP3b322G3fZT2i?blocks=hide)

## 課題1

- アクセス制御の層はオニオンアーキテクチャのどの層？

アクセス制御は現実世界ではなくアプリケーション固有の知識のため、ユースケース層（プレゼンテーション層）に実装する。

- フロントエンドから送られてきたtokenを見てisLoggedInをtrueにするような層

認証の仕組みはプレゼンテーション層に置く。ドメインやユースケースには認証の仕組みの知識は持たせず、ユーザーを渡す。そうすることでユースケース層のユニットテストを書きやすくなる。

- Userエンティティに認証に関するプロパティを増やすのは問題ないか？

増やすてもいいがUserAuthなどに名前を変え、ユーザーの情報はUserエンティティにするなど修正する。ドメインとしてのUserと認証情報としてのUserが混同してしまい、エンティティが肥大化してしまうため。認証用のエンティティを切り出すのがいい。

- 「タスク」と「活動レポート」の集約の保存をする際に整合性を担保したい場合どうするか？

ケースバイケースだが集約を横断してトランザクションをかける。さまざまな要因で同じ集約にできなかったり、どうしてもトランザクションをかけるべきケースが容易に発生し得るように想定できるため、許容するのがいいと思う。


### Userエンティティに「name」などマイページ情報が定義されている場合

- 認証に関わる「firebaseUserId」などのプロパティを増やすことは問題ないか？

問題がある。ドメインとしてのUserと認証情報としてのUserが混同してしまい、エンティティが肥大化してしまうため。認証用のエンティティを切り出すのがいい。

### ブログ投稿サービスで上限1000文字でエラーにしたい場合

- エラーをthrowすることに関してどのような問題があるか？

呼び出し元でエラーをキャッチする際に、どんなエラーが起きるのかを判定しづらく、制御しづらい<br>
TypeScriptだと例外がanyになってしまうので型安全ではなくなる


- エラーをthrowする以外の方法

特定のエラーコードなどを決めて返すことでエラー判別できるようにする

- 「モナド」「Result型」

[TypeScript のエラーハンドリングを考える](https://qiita.com/frozenbonito/items/e708dfb3ab7c1fd3824d)

[Result型のすゝめ](https://zenn.dev/web_tips/books/d76ef4e3a9eed2)