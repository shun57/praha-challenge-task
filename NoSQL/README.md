# Firestoreを使ってリレーショナルDB以外にも慣れる

## 課題1

### RDB的に考えると

```
User: {
    user_id:
    user_name:
}

UserQuestion: {
    id:
    user_id:
    question_id:
    question_status:
}

Question {
    question_id:
    question_title:
}
```

### クエリパターン

- ユーザーをすべて取得する
- 課題をすべて取得する
- ユーザーの課題進捗をすべて取得する

### FireStore構成

```
users: {
    1: {
        id:
        name:
        questions: {
            1: {
                id:
                status:
                title
            },
            2: {
                id:
                status:
                title
            }
        },
    },
}

questions: {
    1: {
        id:
        title:
    },
}
```

## 課題2（実装）

https://github.com/shun57/firestore-praha/tree/main/src


## 課題2(質問)

### NoSQLの正規化

NoSQLではRDBで言うような正規化ではなく、「非正規化」が一般的なパターン。
とはいえ、最初は正規化するのが良いらしい。
RDBではクエリ実行時にJOINするが、NoSQLでは設計時にJOINしておく。

1. ER図を作成する ※正規化
2. アクセスパターンをすべて書き出す
※RDBはよく利用できるデータ構造をもとに設計されるが、NoSQLは固有のアクセスパターンから設計される
3. アクセスパターンをそのままテーブルにする ※非正規化
4. 必要であればテーブルをマージさせ書き込みと読み込みを１テーブルで一致させる
5. インデックスを検討する
6. 上記を繰り返す

#### 参考

- 【レポート】今から理解するNoSQL Databases〜ケーススタディと実践的データモデリング〜 AWS-44 #AWSSummit
https://pages.awscloud.com/rs/112-TZM-766/images/AWS-44_NoSQL-Databases_KMD16-KMD17.pdf

https://dev.classmethod.jp/articles/aws-summit-japan-online-2022-aws-44/


### RDBMSとの比較

#### メリット

- 柔軟性：データ構造に柔軟性があり、要件に合わせて修正しやすい
- スケーラビリティ：水平スケーリング（複数のサーバーにデータを分散）を行いやすく、大量データ処理に適している
- 高性能：特定のデータモデルとアクセスパターンに合わせて最適化できれば、高いパフォーマンスを得られる

#### デメリット

- データの冗長性：非正規化されるため、ストレージ容量が増加する可能性
- ACID特性の欠如：BASE特性が中心的な概念であるため、整合性や一貫性の欠如を一時的に許容する
    - そのためトランザクションをサポートしていない場合もある
※BASE：基本的には常に利用可能で、常に整合性を保っている必要はなく、一時的に一貫性のない状態を許容して、結果的には整合性が取れている状態に至る

#### ユースケース

- リアルタイムデータ管理
> リアルタイムレコメンデーション、パーソナライゼーション、ユーザーエクスペリエンスの向上を実現できます。例えば、Disney+ では、NoSQLデータベーステクノロジーを使用して、1 億 5,000 万人以上のサブスクライバーに広範なデジタルコンテンツライブラリを提供しています。Amazon DynamoDB では、途中から視聴する機能、ウォッチリスト、パーソナライズされたレコメンデーションなどの人気のある機能をスケールおよび提供できます。


- 高可用性アプリケーション
> メッセージング、ソーシャルメディア、ファイル共有などのための高可用性で低レイテンシーアプリケーションを構築するのに最適です。例えば、Snapchat には 2 億 9000 万人以上のユーザーが毎日何十億もの写真やビデオメッセージを送信しています。

#### 参考

- NoSQLで学ぶべきこと
https://zenn.dev/daiyaone/articles/5f1384f0c8a040#nosql%E3%81%AE%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88%E3%81%A8%E3%83%87%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88%E3%81%AE%E7%90%86%E8%A7%A3

- 「RDBMS」と「NoSQL」の比較
https://masawan-guitar.hatenablog.com/entry/2016/08/14/163447