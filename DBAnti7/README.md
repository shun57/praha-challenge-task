# データベース設計のアンチパターンを学ぶ7

[課題内容](https://airtable.com/appPxhCPFYGqqN9YU/tblVlFr2q4lIqDKYc/viwX8r6DpCRp80swL/reczXUDRsTZF9gER2?blocks=hide)

## 課題1

- ユーザ取得や関連テーブルのSQL全てにwehre句でtaikaiFlag = 0をつける必要があるため、つけ忘れが起きる可能性
-  例えばnameをUniqueにしたい場合にnameが新規登録できなくなる
- 例えば休職という状態を足したいということになったときにさらにフラグを追加してwhere句が複雑になってしまう可能性
- 退会後に復帰した際に関連する過去データもそのままでいいのか？など検討する必要がある。

## 課題2

- 退学者テーブルを作り、退会時にトリガーで移す

[ダイアグラム](https://dbdiagram.io/d/61c344f33205b45b73c92dc8)

- 問題:リレーションあったらどうする？=>状態を持たせる？
- 問題:個人情報カラムあったらどうする？=>消す？

## 課題3

- TODOリストアプリで「完了したTODO」を判定したいので、completeFlagというフラグを持たせるような場合。

## 気になること

- よく話に上がるのが、退会後に復帰した場合にどうするか？という話。論理削除で復活させる場合は過去データも復元されてしまう。復元しない場合は退会時に全ての関連情報を削除する？ただそうすると物理削除でよくない？となる。Uniqueを外す方法もあるが登録が怪しくなる。

## 参照情報

[メールアドレスを会員IDにしたときの退会処理](https://qiita.com/saoyagi2/items/f730554c95dd7c3223c2)

[削除フラグっているの？いらないの？](https://www.go-next.co.jp/blog/server_network/25855/)

[ユーザ情報を保存する時のテーブル設計](https://soudai.hatenablog.com/entry/2018/05/01/204442)